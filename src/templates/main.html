{% extends "base.html" %}
{% block title %}Chess{% endblock %}
{% block head %}
	{{ block.super }}
  <style>
  #games table {
    width: 400px;
   }
  #games table {
  }
  #newInvite {
    clear:both;
  }
  div {
  }
  </style>
{% endblock %}
{% block body %}
	{{ block.super }}
	<div class='sectionGroup'>
	<div id='intro' class='section ui-corner-all'>
  	<span id='title' class='pageTitle'>Chess<img src='images/red-king.png' height='30' align='top'></span>
	  <span>Welcome, {{ user.nickname }}.</span>
	  <p><a href='/prefs'><small>prefs</small></a></p>
	</div>
{% if games %}
	<div id='games' class='section ui-corner-all'>
	   <span class='sectionTitle'>Games</span>
	   <center>
     <table id='gamesTable'>
      <tr><th>White</th><th>Black</th><th>Moves</th><th></th></tr>
{% for g in games %}
{% if g.myMove %}
      <tr><td>{{ g.whitePlayer.nickname }}</td><td>{{ g.blackPlayer.nickname }}</td><td>{{ g.moves|length }}</td><td><a href='game?id={{ g.key }}'>Your move</a></td></tr>
{% else %}
      <tr><td>{{ g.whitePlayer.nickname }}</td><td>{{ g.blackPlayer.nickname }}</td><td>{{ g.moves|length }}</td><td><a href='game?id={{ g.key }}'>View</a></td></tr>
{% endif %}
{% endfor %}
     </table>
     </center>
	</div>
{% endif %}
  </div>
  <div class='sectionGroup'>
	<div id='newInvite' class='section ui-corner-all'>
    <span class='sectionTitle'>Start a new game</span>
	  <form method='POST'>
{% if contacts %}
		<select name='invited'>
{% for e in contacts %}
		{% for em in e.email %}
	    <option value="{{ em.address }}">{{ e.title.text }} ({{ em.address }})</option>
    {% endfor %}
{% endfor %}
		</select>
{% else %}
    <label>Email:</label><input type='text' name='invited'></input>
{% endif %}
		<input type='submit' value='Invite'></input>
{% if contacts %}
    <a href='http://www.google.com/contacts'>Manage Contacts</a>
{% endif %}    
		</form>
	</div>
	</div>
	<div class='sectionGroup'>
{% if invitesFrom %}
	<div id='invitesFrom' class='section ui-corner-all'>
    <span class='sectionTitle'>Pending Invites (sent)</span>
	  <form method='POST'>
	   <table>
	    <tr><th>Contact</th><th>Email</th><th>Select</th></tr>
{% for i in invitesFrom %}
{% if i.toUser %}
      <tr><td>{{ i.toUser.nickname }}</td><td>{{ i.toUser.email }}</td><td><input type='checkbox' name='select' value='{{ i.key }}'></input></td></tr>
{% else %}
      <tr><td>Unknown</td><td>{{ i.toEmail }}</td><td><input type='checkbox' name='select' value='{{ i.key }}'></input></td></tr>
{% endif %}
{% endfor %}
	   </table>
      <input type='submit' name='submit' value='Delete'></input>
	 </form>
	</div>
{% endif %}
{% if invitesTo %}
  <div id='invitesTo' class='section ui-corner-all'>
   <span class='sectionTitle'>Pending Invites (received)</span>
   <form method='POST'>
     <table id='pendingInvitesToTable'>
      <tr><th>Contact</th><th>Email</th><th>Select</th></tr>
{% for i in invitesTo %}
      <tr><td>{{ i.fromUser.nickname }}</td><td>{{ i.fromUser.email }}</td><td><input type='checkbox' name='select' value='{{ i.key }}'></input></td></tr>
{% endfor %}
     </table>
    <input type='submit' name='submit' value='Accept'></input>
    <input type='submit' name='submit' value='Reject'></input>
   </form>
  </div>
{% endif %}
  </div>
{% endblock %}